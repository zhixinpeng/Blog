二叉查找树是最常用的一种二叉树，它支持快速插入、删除、查找操作，各个操作的时间复杂度和树的高度成正比，理想情况下，时间复杂度是 O(logn)。

不过，二叉查找树在频繁的动态更新过程中，很容易导致高度变大，极端情况下，二叉树会退化成链表，时间复杂度就会退化到 O(n)。要解决这个复杂度退化的问题，必须设计一种平衡二叉查找树结构，这就是红黑树。

## 什么是平衡二叉查找树

定义：**二叉树中任意一个节点的左右子树的高度相差不能大于 1**。

平衡二叉查找树中平衡的意思，其实就是让整棵树左右看起来比较对称、比较平衡，不要出现左子树很高、右子树很矮的情况。这样能让整棵树的高度相对来说低一些，相应的插入、删除、查找等操作的效率高一些。

## 如何定义一颗红黑树

平衡二叉查找树有很多，比如，Splay Tree（伸展树）、Treap（树堆）等，但是平时提到平衡二叉查找树时，几乎聊得都是红黑树。

红黑树的英文名是 Red-Black Tree，简称 R-B Tree。它是一种不严格的平衡二叉查找树。顾名思义，红黑树中的节点，一类被标记为黑色，一类被标记为红色。除此之外，还满足以下几个要求：

- 根节点是黑色的
- 每个叶子节点都是黑色的空节点（NIL），也就是说，叶子节点不存储数据
- 任何相邻的节点都不能同时为红色，也就是说，红色节点是被黑色节点隔开的
- 每个节点，从该节点到达其可达叶子节点的所有路径，都包含相同数目的黑色节点

这里的第二点要求是为了简化红黑树的代码实现而设置的，在图解时，黑色的、空的叶子节点都会被省略掉。

![img](https://static001.geekbang.org/resource/image/90/9a/903ee0dcb62bce2f5b47819541f9069a.jpg)

## 实现红黑树的基本思想

红黑树的平衡过程跟魔方复原非常神似，大致过程就是：**遇到什么样的节点排布，我们就对应怎么去调整**。只要按照固定的调整规则来操作，就能将一个非平衡的红黑树调整成平衡的。

在插入、删除的过程中，红黑树的第三、四点特定可能会被破坏，而平衡调整就是把被破坏的第三、四点恢复过来。

有两个重要操作，叫**左旋（rotate left）**、**右旋（rotate right）**。就是围绕某个节点进行旋转操作。

![img](https://static001.geekbang.org/resource/image/0e/1e/0e37e597737012593a93105ebbf4591e.jpg)

