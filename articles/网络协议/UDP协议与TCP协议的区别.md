传输层比较重要的两个协议就是 UDP 协议与 TCP 协议。

## TCP 和 UDP 有哪些区别

在面试时，问到这个问题时，大部分会回答，TCP 是面向连接的，UDP 是面向无连接的。

什么是面向连接，什么是无连接呢？在互通之前，面向连接的协议会先建立连接。例如，TCP 会三次握手,而 UDP 不会。为什么要建立连接呢？你 TCP 三次握手，我 UDP 也可以发三个包玩玩，有什么区别吗？

**所谓的建立连接，是为了在客户端和服务端维护连接，而建立一定的数据结构来维护双方交互的状态，用这样的数据结构来保证所谓的面向连接的特性**。

**TCP 提供可靠交付**。通过 TCP 连接传输的数据，无差错、不丢失、不重复、并且按序到达。我们知道 IP 包是没有任何可靠保证的，一旦发出去，都只能随他而去。而**UDP 继承了 IP 包的特性，不保证不丢失，不保证按顺序到达**。

**TCP 是面向字节流的**。发送的时候发的是一个流，没头没尾。IP 包可不是一个流，而是一个个的 IP 包。之所以变成了流，这也是 TCP 自己的状态维护做的事情。而 **UDP 继承了 IP 的特性，基于数据报的，一个一个地发，一个一个地收**。

**TCP 是可以有拥塞控制的**。它意识到包丢弃了或者网络的环境不好了，就会根据情况调整自己的行为，看看是不是发快了，要不要发慢点。**UDP 就不会，应用让我发，我就发，管它洪水滔天**。

因此，**TCP 其实是一个有状态的服务**。而**UDP 则是无状态服务**。

## UDP 的三大特点

- **沟通简单**

  相信网络世界是简单美好的，发出去的数据很容易送达，不容易丢失

- **轻信他人**

  不会建立连接，虽有有端口号，但是监听在这个地方，谁都可以传给他数据，他也可以传给任何人数据，甚至可以同时传给多个人数据

- **愣头青，做事不懂权变**

  不会根据网络的情况进行发包的拥塞控制，无论网络丢包丢成啥样了，该怎么发还是怎么发

## UDP 的三大使用场景

- **需要资源少，在网络情况比较好的内网，或者对于丢包不敏感的应用**
- **不需要一对一沟通，建立连接，而是可以广播的应用**
- **需要处理速度快，时延低，可以容忍少数丢包，但是要求即使网络拥塞，也毫不退缩，一往无前的时候**

## 基于 UPD 的五个例子

- 网页或者 APP 的访问

  Google 基于 UDP 改进的通信协议 **QUIC（全称 Quick UDP Internet Connections，快速 UDP 互联网连接）**。其目的是降低网络通信的延迟，提供更好的用户互动体验。

  QUIC 在应用层上，会自己实现快速建立连接、减少重传时延，自适应拥塞控制。

- 流媒体的协议

  直播协议多用 RTMP，RTMP 是基于 TCP 的。但是直播要求实时性，宁可丢包，也不要卡顿。还有当网络不好时，TCP 协议会主动降低发送速度,这对本来就卡顿的视频更加难受。因此很多直播应用基于 UDP 实现自己的视频传输协议。

- 实时游戏

  游戏实时要求比较严格的情况下，采用自定义的可靠 UDP 协议，自定义重传策略，能够把丢包产生的延迟降到最低，尽量减少网络问题对游戏性能造成的影响

- 物联网

  物联网领域终端资源少，而且对实时性要求较高。Google 旗下 Nest 建立 Thread Group，推出了物联网通信协议 Thread，就是基于 UDP 协议的

- 移动通信领域

  在 4G 网络中，移动流量上网的数据面对的协议 GTP-U 是基于 UDP 的。